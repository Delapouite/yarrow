!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection")):"function"==typeof define&&define.amd?define(["exports","d3-selection"],e):e(t.yarrow=t.yarrow||{},t.d3_selection)}(this,function(t,e){"use strict";var n=function(){var t={},e=[];return t.arrow=function(t,n){n=n||document.body;var o=new r(this,t,n);return e.push(o),o},t.arrows=function(t,n){if(!arguments.length)return e;n=n||document.body;var o=this;return t.forEach(function(t){e.push(new r(o,t,n))}),this},t.remove=function(t){for(var n=-1,r=e.length;n++<r;)if(e[n].id===t)return e.splice(n,1)},t.renderAll=function(){return e.forEach(function(t){t.render()}),this},t.disposeAll=function(){var t=e.slice();return t.forEach(function(t){t.dispose()}),this},t},r=function(t,n,r){var a,i={},s=new o,u="id"+Math.random().toString(36).substr(2,10),d=e.select(r),f=n.x||0,l=n.y||0,h=n.dx||100,c=n.dy||0,p=n.duration||300,g=n.delay||0,y=n.d||function(t,e){return e.m(t.dx>0?0:Math.abs(t.dx),t.dy>0?0:Math.abs(t.dy))+e.l(t.dx>0?t.dx:0,t.dy>0?t.dy:0)},x=n.duration1||200,m=n.delay1||p+g,v=n.d1||function(t,e){return e.m(0,0)+e.l(-20,-10)},w=n.duration2||x,k=n.delay2||p+g,b=n.d2||function(t,e){return e.m(0,0)+e.l(-20,10)},M=n.text,D=("function"==typeof n.textReverseDirection?n.textReverseDirection(n,s):n.textReverseDirection)||!1,L=("function"==typeof n.textStartOffset?n.textStartOffset(n,s,D):n.textStartOffset)||0,T=n.textDx||0,_=n.textDy||-5,A={top:20,right:20,bottom:20,left:20},O=Math.abs(n.dx),S=Math.abs(n.dy),j=Math.min(n.y,n.y+n.dy)-A.top,P=Math.min(n.x,n.x+n.dx)-A.left,R=O+A.left+A.right,E=S+A.top+A.bottom;return i.id=u,i.render=function(){d.select("#"+u).remove(),a=d.append("svg").attrs({id:u,"xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve","class":"yarrow",viewBox:"0 0 "+R+" "+E+" ",width:R+"px",height:E+"px"}).styles({top:j+"px",left:P+"px"});var t,e,r,o,i=a.append("g").attrs({transform:"translate("+A.left+","+A.top+")"}),f=i.append("path").attrs({id:"path_"+u,"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow",d:"function"==typeof y?y(n,s):y}),l=f.node(),h="function"==typeof l.getTotalLength;h?(t=l.getTotalLength(),e=l.getPointAtLength(t-1),r=l.getPointAtLength(t)):(t=0,e={x:0,y:0},r={x:0,y:0}),o=s.angle(e,r),f.styles({"animation-duration":p/1e3+"s","animation-delay":g/1e3+"s","stroke-dasharray":t+" "+t,"stroke-dashoffset":t});var c=i.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-1",d:"function"==typeof v?v(n,s):v,transform:"translate("+r.x+","+r.y+")rotate("+o+")"}),O=h?c.node().getTotalLength():0;c.styles({"animation-duration":x/1e3+"s","animation-delay":m/1e3+"s","stroke-dasharray":O+" "+O,"stroke-dashoffset":O});var S=i.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-2",d:"function"==typeof b?b(n,s):b,transform:"translate("+r.x+","+r.y+")rotate("+o+")"}),q=h?S.node().getTotalLength():0;S.styles({"animation-duration":w/1e3+"s","animation-delay":k/1e3+"s","stroke-dasharray":q+" "+q,"stroke-dashoffset":q});var z=(i.append("path").attrs({id:"path_reverse_"+u,d:("function"==typeof y?y(n,s):y)+" z"}),i.append("text").attrs({"class":"arrow text",dx:T,dy:_})),B=z.append("textPath").attrs({"xlink:href":D?"#path_reverse_"+u:"#path_"+u,startOffset:D?2*t-L:L}).styles({opacity:0}).text(M);return setTimeout(function(){B.styles({transition:"all "+p/1e3+"s linear",opacity:1})},10),this},i.dispose=function(e,n){function r(t,e){return e?(t.selectAll(".arrow").styles({transition:"all "+e/1e3+"s linear",opacity:0}),void setTimeout(function(){return t.remove()},e)):t.remove()}var o=d.select("#"+u);t.remove(u),n?setTimeout(function(){r(o,e)},n):r(o,e)},i.x=function(t){return arguments.length?(f=t,this):f},i.y=function(t){return arguments.length?(l=t,this):l},i.dx=function(t){return arguments.length?(h=t,this):h},i.dy=function(t){return arguments.length?(c=t,this):c},i.duration=function(t){return arguments.length?(p=t,this):p},i.delay=function(t){return arguments.length?(g=t,this):g},i.d=function(t){return arguments.length?(y=t,this):y},i.duration1=function(t){return arguments.length?(x=t,this):x},i.delay1=function(t){return arguments.length?(m=t,this):m},i.d1=function(t){return arguments.length?(v=t,this):v},i.duration2=function(t){return arguments.length?(w=t,this):w},i.delay2=function(t){return arguments.length?(k=t,this):k},i.d2=function(t){return arguments.length?(v=t,this):v},i.text=function(t){return arguments.length?(M=t,this):M},i.textReverseDirection=function(t){return arguments.length?(D=t,this):D},i.textStartOffset=function(t){return arguments.length?(L=t,this):L},i.textDx=function(t){return arguments.length?(T=t,this):T},i.textDy=function(t){return arguments.length?(_=t,this):_},i},o=function(){var t={};return t.m=function(t,e){return"M"+t+","+e+" "},t.l=function(t,e){return"L"+t+","+e+" "},t.angle=function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},t};t.Yarrow=n});