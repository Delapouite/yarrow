!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection")):"function"==typeof define&&define.amd?define(["exports","d3-selection"],e):e(t.yarrow=t.yarrow||{},t.d3_selection)}(this,function(t,e){"use strict";var n=function(){var t={},e=[];return t.arrow=function(t,n){n=n||document.body;var a=new r(this,t,n);return e.push(a),a},t.arrows=function(t,n){if(!arguments.length)return e;n=n||document.body;var a=this;return t.forEach(function(t){e.push(new r(a,t,n))}),this},t.remove=function(t){for(var n=-1,r=e.length;n++<r;)if(e[n].id===t)return e.splice(n,1)},t.renderAll=function(){return e.forEach(function(t){t.render()}),this},t.disposeAll=function(){var t=e.slice();return t.forEach(function(t){t.dispose()}),this},t},r=function(t,n,r){var o={},i=new a,s="id"+Math.random().toString(36).substr(2,10),d=e.select(r),u={};return u={x:n.x||0,y:n.y||0,dx:n.dx||100,dy:n.dy||0,duration:n.duration||300,delay:n.delay||0,d:n.d||function(t,e){return e.m(t.dx>0?0:Math.abs(t.dx),t.dy>0?0:Math.abs(t.dy))+e.l(t.dx>0?t.dx:0,t.dy>0?t.dy:0)},duration1:n.duration1||200,delay1:n.delay1||n.duration+n.delay,d1:n.d1||function(t,e){return e.m(0,0)+e.l(-20,-10)},duration2:n.duration2||n.duration1,delay2:n.delay2||n.duration+n.delay,d2:n.d2||function(t,e){return e.m(0,0)+e.l(-20,10)},text:n.text,textDx:n.textDx||0,textDy:n.textDy||-5},u.textReverseDirection=("function"==typeof n.textReverseDirection?n.textReverseDirection(u,i):n.textReverseDirection)||!1,u.textStartOffset=("function"==typeof n.textStartOffset?n.textStartOffset(u,i,u.textReverseDirection):n.textStartOffset)||0,o.id=s,o.render=function(){var t,e={top:20,right:20,bottom:20,left:20},n=Math.abs(u.dx),r=Math.abs(u.dy),a=Math.min(u.y,u.y+u.dy)-e.top,o=Math.min(u.x,u.x+u.dx)-e.left,f=n+e.left+e.right,l=r+e.top+e.bottom;d.select("#"+s).remove(),t=d.append("svg").attrs({id:s,"xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve","class":"yarrow",viewBox:"0 0 "+f+" "+l+" ",width:f+"px",height:l+"px"}).styles({top:a+"px",left:o+"px"});var c,h,x,y,p=t.append("g").attrs({transform:"translate("+e.left+","+e.top+")"}),g=p.append("path").attrs({id:"path_"+s,"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow",d:"function"==typeof u.d?u.d(u,i):u.d}),m=g.node(),v="function"==typeof m.getTotalLength;v?(c=m.getTotalLength(),h=m.getPointAtLength(c-1),x=m.getPointAtLength(c)):(c=0,h={x:0,y:0},x={x:0,y:0}),y=i.angle(h,x),g.styles({"animation-duration":u.duration/1e3+"s","animation-delay":u.delay/1e3+"s","stroke-dasharray":c+" "+c,"stroke-dashoffset":c});var D=p.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-1",d:"function"==typeof u.d1?u.d1(u,i):u.d1,transform:"translate("+x.x+","+x.y+")rotate("+y+")"}),w=v?D.node().getTotalLength():0;D.styles({"animation-duration":u.duration1/1e3+"s","animation-delay":u.delay1/1e3+"s","stroke-dasharray":w+" "+w,"stroke-dashoffset":w});var k=p.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-2",d:"function"==typeof u.d2?u.d2(u,i):u.d2,transform:"translate("+x.x+","+x.y+")rotate("+y+")"}),b=v?k.node().getTotalLength():0;k.styles({"animation-duration":u.duration2/1e3+"s","animation-delay":u.delay2/1e3+"s","stroke-dasharray":b+" "+b,"stroke-dashoffset":b});var M=(p.append("path").attrs({id:"path_reverse_"+s,d:("function"==typeof u.d?u.d(u,i):u.d)+" z"}),p.append("text").attrs({"class":"arrow text",dx:u.textDx,dy:u.textDy})),O=M.append("textPath").attrs({"xlink:href":u.textReverseDirection?"#path_reverse_"+s:"#path_"+s,startOffset:u.textReverseDirection?2*c-u.textStartOffset:u.textStartOffset}).styles({opacity:0}).text(u.text);return setTimeout(function(){O.styles({transition:"all "+u.duration/1e3+"s linear",opacity:1})},10),this},o.dispose=function(e,n){function r(t,e){return e?(t.selectAll(".arrow").styles({transition:"all "+e/1e3+"s linear",opacity:0}),void setTimeout(function(){return t.remove()},e)):t.remove()}var a=d.select("#"+s);t.remove(s),n?setTimeout(function(){r(a,e)},n):r(a,e)},o.x=function(t){return arguments.length?(u.x=t,this):u.x},o.y=function(t){return arguments.length?(u.y=t,this):u.y},o.dx=function(t){return arguments.length?(u.dx=t,this):u.dx},o.dy=function(t){return arguments.length?(u.dy=t,this):u.dy},o.duration=function(t){return arguments.length?(u.duration=t,this):u.duration},o.delay=function(t){return arguments.length?(u.delay=t,this):u.delay},o.d=function(t){return arguments.length?(u.d=t,this):u.d},o.duration1=function(t){return arguments.length?(u.duration1=t,this):u.duration1},o.delay1=function(t){return arguments.length?(u.delay1=t,this):u.delay1},o.d1=function(t){return arguments.length?(u.d1=t,this):u.d1},o.duration2=function(t){return arguments.length?(u.duration2=t,this):u.duration2},o.delay2=function(t){return arguments.length?(u.delay2=t,this):u.delay2},o.d2=function(t){return arguments.length?(u.d1=t,this):u.d1},o.text=function(t){return arguments.length?(u.text=t,this):u.text},o.textReverseDirection=function(t){return arguments.length?(u.textReverseDirection=t,this):u.textReverseDirection},o.textStartOffset=function(t){return arguments.length?(u.textStartOffset=t,this):u.textStartOffset},o.textDx=function(t){return arguments.length?(u.textDx=t,this):u.textDx},o.textDy=function(t){return arguments.length?(u.textDy=t,this):u.textDy},o},a=function(){var t={};return t.m=function(t,e){return"M"+t+","+e+" "},t.l=function(t,e){return"L"+t+","+e+" "},t.angle=function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},t};t.Yarrow=n});