!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("svg-path-utils")):"function"==typeof define&&define.amd?define(["exports","d3-selection","svg-path-utils"],e):e(t.yarrow=t.yarrow||{},t.d3_selection,t.svg_path_utils)}(this,function(t,e,n){"use strict";var r=function(){var t={},e=[];return t.arrow=function(t,n){n=n||document.body;var r=new o(this,t,n);return e.push(r),r},t.arrows=function(t,n){if(!arguments.length)return e;n=n||document.body;var r=this;return t.forEach(function(t){e.push(new o(r,t,n))}),this},t.remove=function(t){for(var n=-1,r=e.length;n++<r;)if(e[n].id===t)return e.splice(n,1)},t.renderAll=function(){return e.forEach(function(t){t.render()}),this},t.disposeAll=function(){var t=e.slice();return t.forEach(function(t){t.dispose()}),this},t},o=function(t,r,o){function a(t,e){function n(t){for(var e=0,n=0;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)e+=t.offsetLeft-t.scrollLeft,n+=t.offsetTop-t.scrollTop,t=t.offsetParent;return{top:n,left:e}}var r=t.getBoundingClientRect(),o=r.right-r.left,a=r.bottom-r.top,i=n(t),s=n(e);return{element:t,top:i.top-s.top,left:i.left-s.left,width:o,height:a}}var i={},s=new n.SVGPathUtils,u="id"+Math.random().toString(36).substr(2,10),l=e.select(o),d={};d={animation:"undefined"==typeof r.animation?!0:r.animation,x1:r.x1||0,y1:r.y1||0,x2:r.x2||0,y2:r.y2||0,d:r.d||function(t,e){return e.join(e.M(t.x2-t.x1>0?0:Math.abs(t.x2-t.x1),t.y2-t.y1>0?0:Math.abs(t.y2-t.y1)),e.L(t.x2-t.x1>0?t.x2-t.x1:0,t.y2-t.y1>0?t.y2-t.y1:0))},d1:r.d1||function(t,e){return e.join(e.m(0,0),e.l(-20,-10))},d2:r.d2||function(t,e){return e.join(e.m(0,0),e.l(-20,10))},arrowStyles:r.arrowStyles||{},text:r.text,textDx:r.textDx||0,textDy:r.textDy||-5,textStyles:r.textStyles||{}};var f;return r.source&&(f=e.select(r.source).node())&&(d.source=a(f,o)),r.target&&(f=e.select(r.target).node())&&(d.target=a(f,o)),"function"==typeof r.x1&&(d.x1=r.x1(d)),"function"==typeof r.y1&&(d.y1=r.y1(d)),"function"==typeof r.x2&&(d.x2=r.x2(d)),"function"==typeof r.y2&&(d.y2=r.y2(d)),d.duration=r.duration||300,d.delay=r.delay||0,d.duration1=r.duration1||200,d.delay1=r.delay1||d.duration+d.delay,d.duration2=r.duration2||d.duration1,d.delay2=r.delay2||d.duration+d.delay,d.textReverseDirection=("function"==typeof r.textReverseDirection?r.textReverseDirection(d,s):r.textReverseDirection)||!1,d.textStartOffset=("function"==typeof r.textStartOffset?r.textStartOffset(d,s):r.textStartOffset)||0,i.id=u,i.render=function(){var t,e={top:20,right:20,bottom:20,left:20},n=Math.abs(d.x2-d.x1),r=Math.abs(d.y2-d.y1),o=Math.min(d.y1,d.y2)-e.top,a=Math.min(d.x1,d.x2)-e.left,i=n+e.left+e.right,f=r+e.top+e.bottom;l.select("#"+u).remove(),t=l.append("svg").attrs({id:u,"xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve","class":"yarrow",viewBox:"0 0 "+i+" "+f+" ",width:i+"px",height:f+"px"}).styles({top:o+"px",left:a+"px"});var y,c,h,x,p=t.append("g").attrs({transform:"translate("+e.left+","+e.top+")"}),g=p.append("path").attrs({id:"path_"+u,"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow",d:"function"==typeof d.d?d.d(d,s):d.d}).styles(d.arrowStyles),m=g.node(),v="function"==typeof m.getTotalLength;v?(y=m.getTotalLength(),c=m.getPointAtLength(y-1),h=m.getPointAtLength(y)):(y=0,c={x:0,y:0},h={x:0,y:0}),x=s.angle(c,h),d.animation&&g.styles({"animation-duration":d.duration/1e3+"s","animation-delay":d.delay/1e3+"s","stroke-dasharray":y+" "+y,"stroke-dashoffset":y});var w=p.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-1",d:"function"==typeof d.d1?d.d1(d,s):d.d1,transform:"translate("+h.x+","+h.y+")rotate("+x+")"});if(d.animation){var S=v?w.node().getTotalLength():0;w.styles({"animation-duration":d.duration1/1e3+"s","animation-delay":d.delay1/1e3+"s","stroke-dasharray":S+" "+S,"stroke-dashoffset":S})}w.styles(d.arrowStyles);var D=p.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-2",d:"function"==typeof d.d2?d.d2(d,s):d.d2,transform:"translate("+h.x+","+h.y+")rotate("+x+")"});if(d.animation){var k=v?D.node().getTotalLength():0;D.styles({"animation-duration":d.duration2/1e3+"s","animation-delay":d.delay2/1e3+"s","stroke-dasharray":k+" "+k,"stroke-dashoffset":k})}D.styles(d.arrowStyles),d.textReverseDirection&&p.append("path").attrs({id:"path_reverse_"+u,d:s.inversePath("function"==typeof d.d?d.d(d,s):d.d)}).style("display","none");var b=p.append("text").attrs({"class":"arrow text",dx:d.textDx,dy:d.textDy}).styles(d.textStyles),O=b.append("textPath").attrs({"xlink:href":d.textReverseDirection?"#path_reverse_"+u:"#path_"+u,startOffset:d.textReverseDirection?y-d.textStartOffset:d.textStartOffset}).html(d.text);return d.animation&&(O.styles({opacity:0}),setTimeout(function(){O.styles({transition:"all "+d.duration/1e3+"s linear",opacity:1})},10)),this},i.dispose=function(e,n){function r(t,e){return e?(t.selectAll(".arrow").styles({transition:"all "+e/1e3+"s linear",opacity:0}),void setTimeout(function(){return t.remove()},e)):t.remove()}var o=l.select("#"+u);t.remove(u),n?setTimeout(function(){r(o,e)},n):r(o,e)},i.options=function(t){if(!arguments.length)return d;for(var e in t)d.hasOwnProperty(e)&&(d[e]=t[e]);return this},i.x1=function(t){return arguments.length?(d.x1=t,this):d.x1},i.y1=function(t){return arguments.length?(d.y1=t,this):d.y1},i.x2=function(t){return arguments.length?(d.x2=t,this):d.x2},i.y2=function(t){return arguments.length?(d.y2=t,this):d.y2},i.duration=function(t){return arguments.length?(d.duration=t,this):d.duration},i.delay=function(t){return arguments.length?(d.delay=t,this):d.delay},i.d=function(t){return arguments.length?(d.d=t,this):d.d},i.duration1=function(t){return arguments.length?(d.duration1=t,this):d.duration1},i.delay1=function(t){return arguments.length?(d.delay1=t,this):d.delay1},i.d1=function(t){return arguments.length?(d.d1=t,this):d.d1},i.duration2=function(t){return arguments.length?(d.duration2=t,this):d.duration2},i.delay2=function(t){return arguments.length?(d.delay2=t,this):d.delay2},i.d2=function(t){return arguments.length?(d.d1=t,this):d.d1},i.arrowStyles=function(t){return arguments.length?(d.arrowStyles=t,this):d.arrowStyles},i.text=function(t){return arguments.length?(d.text=t,this):d.text},i.textReverseDirection=function(t){return arguments.length?(d.textReverseDirection=t,this):d.textReverseDirection},i.textStartOffset=function(t){return arguments.length?(d.textStartOffset=t,this):d.textStartOffset},i.textDx=function(t){return arguments.length?(d.textDx=t,this):d.textDx},i.textDy=function(t){return arguments.length?(d.textDy=t,this):d.textDy},i.textStyles=function(t){return arguments.length?(d.textStyles=t,this):d.textStyles},i};t.Yarrow=r});