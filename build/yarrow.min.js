!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection")):"function"==typeof define&&define.amd?define(["exports","d3-selection"],e):e(t.yarrow=t.yarrow||{},t.d3_selection)}(this,function(t,e){"use strict";var n=function(){var t={},e=[];return t.arrow=function(t,n){n=n||document.body;var o=new r(this,t,n);return e.push(o),o},t.arrows=function(t,n){if(!arguments.length)return e;n=n||document.body;var o=this;return t.forEach(function(t){e.push(new r(o,t,n))}),this},t.remove=function(t){for(var n=-1,r=e.length;n++<r;)if(e[n].id===t)return e.splice(n,1)},t.renderAll=function(){return e.forEach(function(t){t.render()}),this},t.disposeAll=function(){var t=e.slice();return t.forEach(function(t){t.dispose()}),this},t},r=function(t,n,r){var a,i={},s=new o,d="id"+Math.random().toString(36).substr(2,10),f=e.select(r),u=n.duration||300,l=n.delay||0,c=n.d||function(t,e){return e.m(t.dx>0?0:Math.abs(t.dx),t.dy>0?0:Math.abs(t.dy))+e.l(t.dx>0?t.dx:0,t.dy>0?t.dy:0)},p=n.duration1||200,h=n.delay1||u+l,y=n.d1||function(t,e){return e.m(0,0)+e.l(-20,-10)},x=n.duration2||p,m=n.delay||u+l,v=n.d2||function(t,e){return e.m(0,0)+e.l(-20,10)},g=n.text,w=("function"==typeof n.textReverseDirection?n.textReverseDirection(n,s):n.textReverseDirection)||!1,k=("function"==typeof n.textStartOffset?n.textStartOffset(n,s,w):n.textStartOffset)||0,b=n.textDx||0,M=n.textDy||-5,L={top:20,right:20,bottom:20,left:20},T=Math.abs(n.dx),_=Math.abs(n.dy),A=Math.min(n.y,n.y+n.dy)-L.top,D=Math.min(n.x,n.x+n.dx)-L.left,j=T+L.left+L.right,O=_+L.top+L.bottom;return i.id=d,i.render=function(){a=f.append("svg").attrs({id:d,"xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve","class":"yarrow",viewBox:"0 0 "+j+" "+O+" ",width:j+"px",height:O+"px"}).styles({top:A+"px",left:D+"px"});var t,e,r,o,i=a.append("g").attrs({transform:"translate("+L.left+","+L.top+")"}),T=i.append("path").attrs({id:"path_"+d,"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow",d:"function"==typeof c?c(n,s):c}),_=T.node(),P="function"==typeof _.getTotalLength;P?(t=_.getTotalLength(),e=_.getPointAtLength(t-1),r=_.getPointAtLength(t)):(t=0,e={x:0,y:0},r={x:0,y:0}),o=s.angle(e,r),T.styles({"animation-duration":u/1e3+"s","animation-delay":l/1e3+"s","stroke-dasharray":t+" "+t,"stroke-dashoffset":t});var S=i.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-1",d:"function"==typeof y?y(n,s):y,transform:"translate("+r.x+","+r.y+")rotate("+o+")"}),E=P?S.node().getTotalLength():0;S.styles({"animation-duration":p/1e3+"s","animation-delay":h/1e3+"s","stroke-dasharray":E+" "+E,"stroke-dashoffset":E});var R=i.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-2",d:"function"==typeof v?v(n,s):v,transform:"translate("+r.x+","+r.y+")rotate("+o+")"}),q=P?R.node().getTotalLength():0;R.styles({"animation-duration":x/1e3+"s","animation-delay":m/1e3+"s","stroke-dasharray":q+" "+q,"stroke-dashoffset":q});var z=(i.append("path").attrs({id:"path_reverse_"+d,d:("function"==typeof c?c(n,s):c)+" z"}),i.append("text").attrs({"class":"arrow text",dx:b,dy:M})),B=z.append("textPath").attrs({"xlink:href":w?"#path_reverse_"+d:"#path_"+d,startOffset:w?2*t-k:k}).styles({opacity:0}).text(g);return setTimeout(function(){B.styles({transition:"all "+u/1e3+"s linear",opacity:1})},10),this},i.dispose=function(e,n){function r(t,e){return e?(t.selectAll(".arrow").styles({transition:"all "+e/1e3+"s linear",opacity:0}),void setTimeout(function(){return t.remove()},e)):t.remove()}var o=f.select("#"+d);t.remove(d),n?setTimeout(function(){r(o,e)},n):r(o,e)},i},o=function(){var t={};return t.m=function(t,e){return"M"+t+","+e+" "},t.l=function(t,e){return"L"+t+","+e+" "},t.angle=function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},t};t.Yarrow=n});