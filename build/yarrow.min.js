!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection")):"function"==typeof define&&define.amd?define(["exports","d3-selection"],e):e(t.yarrow=t.yarrow||{},t.d3_selection)}(this,function(t,e){"use strict";var n=function(){var t={},e=[];return t.arrow=function(t,n){n=n||document.body;var o=new r(this,t,n);return e.push(o),o},t.arrows=function(t,n){if(!arguments.length)return e;n=n||document.body;var o=this;return t.forEach(function(t){e.push(new r(o,t,n))}),this},t.remove=function(t){for(var n=-1,r=e.length;n++<r;)if(e[n].id===t)return e.splice(n,1)},t.renderAll=function(){return e.forEach(function(t){t.render()}),this},t.disposeAll=function(){var t=e.slice();return t.forEach(function(t){t.dispose()}),this},t},r=function(t,n,r){var i={},a=new o,u="id"+Math.random().toString(36).substr(2,10),s=e.select(r),d={};return d={x:n.x||0,y:n.y||0,dx:n.dx||100,dy:n.dy||0,d:n.d||function(t,e){return e.M(t.dx>0?0:Math.abs(t.dx),t.dy>0?0:Math.abs(t.dy))+e.L(t.dx>0?t.dx:0,t.dy>0?t.dy:0)},d1:n.d1||function(t,e){return e.m(0,0)+e.l(-20,-10)},d2:n.d2||function(t,e){return e.m(0,0)+e.l(-20,10)},text:n.text,textDx:n.textDx||0,textDy:n.textDy||-5},d.duration=n.duration||300,d.delay=n.delay||0,d.duration1=n.duration1||200,d.delay1=n.delay1||d.duration+d.delay,d.duration2=n.duration2||d.duration1,d.delay2=n.delay2||d.duration+d.delay,d.textReverseDirection=("function"==typeof n.textReverseDirection?n.textReverseDirection(d,a):n.textReverseDirection)||!1,d.textStartOffset=("function"==typeof n.textStartOffset?n.textStartOffset(d,a,d.textReverseDirection):n.textStartOffset)||0,i.id=u,i.render=function(){var t,e={top:20,right:20,bottom:20,left:20},n=Math.abs(d.dx),r=Math.abs(d.dy),o=Math.min(d.y,d.y+d.dy)-e.top,i=Math.min(d.x,d.x+d.dx)-e.left,f=n+e.left+e.right,c=r+e.top+e.bottom;s.select("#"+u).remove(),t=s.append("svg").attrs({id:u,"xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve","class":"yarrow",viewBox:"0 0 "+f+" "+c+" ",width:f+"px",height:c+"px"}).styles({top:o+"px",left:i+"px"});var l,h,x,y,p=t.append("g").attrs({transform:"translate("+e.left+","+e.top+")"}),g=p.append("path").attrs({id:"path_"+u,"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow",d:"function"==typeof d.d?d.d(d,a):d.d}),m=g.node(),v="function"==typeof m.getTotalLength;v?(l=m.getTotalLength(),h=m.getPointAtLength(l-1),x=m.getPointAtLength(l)):(l=0,h={x:0,y:0},x={x:0,y:0}),y=a.angle(h,x),g.styles({"animation-duration":d.duration/1e3+"s","animation-delay":d.delay/1e3+"s","stroke-dasharray":l+" "+l,"stroke-dashoffset":l});var D=p.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-1",d:"function"==typeof d.d1?d.d1(d,a):d.d1,transform:"translate("+x.x+","+x.y+")rotate("+y+")"}),w=v?D.node().getTotalLength():0;D.styles({"animation-duration":d.duration1/1e3+"s","animation-delay":d.delay1/1e3+"s","stroke-dasharray":w+" "+w,"stroke-dashoffset":w});var k=p.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-2",d:"function"==typeof d.d2?d.d2(d,a):d.d2,transform:"translate("+x.x+","+x.y+")rotate("+y+")"}),M=v?k.node().getTotalLength():0;k.styles({"animation-duration":d.duration2/1e3+"s","animation-delay":d.delay2/1e3+"s","stroke-dasharray":M+" "+M,"stroke-dashoffset":M});var S=(p.append("path").attrs({id:"path_reverse_"+u,d:("function"==typeof d.d?d.d(d,a):d.d)+" z"}),p.append("text").attrs({"class":"arrow text",dx:d.textDx,dy:d.textDy})),b=S.append("textPath").attrs({"xlink:href":d.textReverseDirection?"#path_reverse_"+u:"#path_"+u,startOffset:d.textReverseDirection?2*l-d.textStartOffset:d.textStartOffset}).styles({opacity:0}).text(d.text);return setTimeout(function(){b.styles({transition:"all "+d.duration/1e3+"s linear",opacity:1})},10),this},i.dispose=function(e,n){function r(t,e){return e?(t.selectAll(".arrow").styles({transition:"all "+e/1e3+"s linear",opacity:0}),void setTimeout(function(){return t.remove()},e)):t.remove()}var o=s.select("#"+u);t.remove(u),n?setTimeout(function(){r(o,e)},n):r(o,e)},i.x=function(t){return arguments.length?(d.x=t,this):d.x},i.y=function(t){return arguments.length?(d.y=t,this):d.y},i.dx=function(t){return arguments.length?(d.dx=t,this):d.dx},i.dy=function(t){return arguments.length?(d.dy=t,this):d.dy},i.duration=function(t){return arguments.length?(d.duration=t,this):d.duration},i.delay=function(t){return arguments.length?(d.delay=t,this):d.delay},i.d=function(t){return arguments.length?(d.d=t,this):d.d},i.duration1=function(t){return arguments.length?(d.duration1=t,this):d.duration1},i.delay1=function(t){return arguments.length?(d.delay1=t,this):d.delay1},i.d1=function(t){return arguments.length?(d.d1=t,this):d.d1},i.duration2=function(t){return arguments.length?(d.duration2=t,this):d.duration2},i.delay2=function(t){return arguments.length?(d.delay2=t,this):d.delay2},i.d2=function(t){return arguments.length?(d.d1=t,this):d.d1},i.text=function(t){return arguments.length?(d.text=t,this):d.text},i.textReverseDirection=function(t){return arguments.length?(d.textReverseDirection=t,this):d.textReverseDirection},i.textStartOffset=function(t){return arguments.length?(d.textStartOffset=t,this):d.textStartOffset},i.textDx=function(t){return arguments.length?(d.textDx=t,this):d.textDx},i.textDy=function(t){return arguments.length?(d.textDy=t,this):d.textDy},i},o=function(){var t={};return t.M=function(t,e){return"M"+t+","+e+" "},t.m=function(t,e){return"m"+t+","+e+" "},t.L=function(t,e){return"L"+t+","+e+" "},t.l=function(t,e){return"l"+t+","+e+" "},t.H=function(t){return"H"+t+" "},t.h=function(t){return"h"+t+" "},t.V=function(t){return"V"+t+" "},t.v=function(t){return"v"+t+" "},t.C=function(t,e,n,r,o,i){return"C"+t+","+e+" "+n+","+r+" "+o+","+i+" "},t.c=function(t,e,n,r,o,i){return"c"+t+","+e+" "+n+","+r+" "+o+","+i+" "},t.S=function(t,e,n,r){return"S"+t+","+e+" "+n+","+r+" "},t.s=function(t,e,n,r){return"s"+t+","+e+" "+n+","+r+" "},t.Q=function(t,e,n,r){return"Q"+t+","+e+" "+n+","+r+" "},t.q=function(t,e,n,r){return"q"+t+","+e+" "+n+","+r+" "},t.T=function(t,e){return"T"+t+","+e+" "},t.t=function(t,e){return"t"+t+","+e+" "},t.Z=function(){return"Z"},t.z=function(){return"z"},t.angle=function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},t};t.Yarrow=n});