!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("svg-path-utils")):"function"==typeof define&&define.amd?define(["exports","d3-selection","svg-path-utils"],e):e(t.yarrow=t.yarrow||{},t.d3_selection,t.svg_path_utils)}(this,function(t,e,n){"use strict";var r=function(){var t={},e=[];return t.arrow=function(t,n){n=n||document.body;var r=new o(this,t,n);return e.push(r),r},t.arrows=function(t,n){if(!arguments.length)return e;n=n||document.body;var r=this;return t.forEach(function(t){e.push(new o(r,t,n))}),this},t.remove=function(t){for(var n=-1,r=e.length;n++<r;)if(e[n].id===t)return e.splice(n,1)},t.renderAll=function(){return e.forEach(function(t){t.render()}),this},t.disposeAll=function(){var t=e.slice();return t.forEach(function(t){t.dispose()}),this},t},o=function(t,r,o){function i(t,e){function n(t){for(var e=0,n=0;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)e+=t.offsetLeft-t.scrollLeft,n+=t.offsetTop-t.scrollTop,t=t.offsetParent;return{top:n,left:e}}var r=t.getBoundingClientRect(),o=r.right-r.left,i=r.bottom-r.top,a=n(t),s=n(e);return{element:t,top:a.top-s.top,left:a.left-s.left,width:o,height:i}}function a(){"function"==typeof r.x1&&(l.x1=r.x1(l)),"function"==typeof r.y1&&(l.y1=r.y1(l)),"function"==typeof r.x2&&(l.x2=r.x2(l)),"function"==typeof r.y2&&(l.y2=r.y2(l))}var s={},u=new n.SVGPathUtils,d="id"+Math.random().toString(36).substr(2,10),f=e.select(o),l={};l={animation:"undefined"==typeof r.animation?!0:r.animation,x1:r.x1||0,y1:r.y1||0,x2:r.x2||0,y2:r.y2||0,d:r.d||function(t,e){return e.join(e.M(t.dx>0?0:t.w,t.dy>0?0:t.h),e.L(t.dx>0?t.dx:0,t.dy>0?t.dy:0))},d1:r.d1||function(t,e){return e.join(e.m(0,0),e.l(-20,-10))},d2:r.d2||function(t,e){return e.join(e.m(0,0),e.l(-20,10))},arrowStyles:r.arrowStyles||{},text:r.text,textDx:r.textDx||0,textDy:r.textDy||-5,textStyles:r.textStyles||{},margin:Object.assign({},{top:20,right:20,bottom:20,left:20},r.margin),get dx(){return this.x2-this.x1},get dy(){return this.y2-this.y1},get w(){return Math.abs(this.dx)},get h(){return Math.abs(this.dy)}};var c;return r.source&&(c=e.select(r.source).node())&&(l.source=i(c,o)),r.target&&(c=e.select(r.target).node())&&(l.target=i(c,o)),a(),l.duration=r.duration||300,l.delay=r.delay||0,l.duration1=r.duration1||200,l.delay1=r.delay1||l.duration+l.delay,l.duration2=r.duration2||l.duration1,l.delay2=r.delay2||l.duration+l.delay,l.textReverseDirection=("function"==typeof r.textReverseDirection?r.textReverseDirection(l,u):r.textReverseDirection)||!1,l.textStartOffset=("function"==typeof r.textStartOffset?r.textStartOffset(l,u):r.textStartOffset)||0,s.id=d,s.render=function(){var t,e=l.margin,n=l.w,r=l.h,o=Math.min(l.y1,l.y2)-e.top,i=Math.min(l.x1,l.x2)-e.left,a=n+e.left+e.right,s=r+e.top+e.bottom;f.select("#"+d).remove(),t=f.append("svg").attrs({id:d,"xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve","class":"yarrow",viewBox:"0 0 "+a+" "+s+" ",width:a+"px",height:s+"px"}).styles({top:o+"px",left:i+"px"});var c,h,y,g,x=t.append("g").attrs({transform:"translate("+e.left+","+e.top+")"}),p=x.append("path").attrs({id:"path_"+d,"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow",d:"function"==typeof l.d?l.d(l,u):l.d}).styles(l.arrowStyles),m=p.node(),v="function"==typeof m.getTotalLength;v?(c=m.getTotalLength(),h=m.getPointAtLength(c-1),y=m.getPointAtLength(c)):(c=0,h={x:0,y:0},y={x:0,y:0}),g=u.angle(h,y),l.animation&&p.styles({"animation-duration":l.duration/1e3+"s","animation-delay":l.delay/1e3+"s","stroke-dasharray":c+" "+c,"stroke-dashoffset":c});var w=x.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-1",d:"function"==typeof l.d1?l.d1(l,u):l.d1,transform:"translate("+y.x+","+y.y+")rotate("+g+")"});if(l.animation){var S=v?w.node().getTotalLength():0;w.styles({"animation-duration":l.duration1/1e3+"s","animation-delay":l.delay1/1e3+"s","stroke-dasharray":S+" "+S,"stroke-dashoffset":S})}w.styles(l.arrowStyles);var D=x.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-2",d:"function"==typeof l.d2?l.d2(l,u):l.d2,transform:"translate("+y.x+","+y.y+")rotate("+g+")"});if(l.animation){var b=v?D.node().getTotalLength():0;D.styles({"animation-duration":l.duration2/1e3+"s","animation-delay":l.delay2/1e3+"s","stroke-dasharray":b+" "+b,"stroke-dashoffset":b})}D.styles(l.arrowStyles),l.textReverseDirection&&x.append("path").attrs({id:"path_reverse_"+d,d:u.inversePath("function"==typeof l.d?l.d(l,u):l.d)}).style("display","none");var j=x.append("text").attrs({"class":"arrow text",dx:l.textDx,dy:l.textDy}).styles(l.textStyles),O=j.append("textPath").attrs({"xlink:href":l.textReverseDirection?"#path_reverse_"+d:"#path_"+d,startOffset:l.textReverseDirection?c-l.textStartOffset:l.textStartOffset}).html(l.text);return l.animation&&(O.styles({opacity:0}),setTimeout(function(){O.styles({transition:"all "+l.duration/1e3+"s linear",opacity:1})},10)),this},s.dispose=function(e,n){function r(t,e){return e?(t.selectAll(".arrow").styles({transition:"all "+e/1e3+"s linear",opacity:0}),void setTimeout(function(){return t.remove()},e)):t.remove()}var o=f.select("#"+d);t.remove(d),n?setTimeout(function(){r(o,e)},n):r(o,e)},s.options=function(t){if(!arguments.length)return l;for(var e in t)l.hasOwnProperty(e)&&(l[e]=t[e]);return this},s.x1=function(t){return arguments.length?(l.x1=t,this):l.x1},s.y1=function(t){return arguments.length?(l.y1=t,this):l.y1},s.x2=function(t){return arguments.length?(l.x2=t,this):l.x2},s.y2=function(t){return arguments.length?(l.y2=t,this):l.y2},s.source=function(t){return arguments.length?(l.source=t,a(),this):l.source},s.target=function(t){return arguments.length?(l.target=t,a(),this):l.target},s.duration=function(t){return arguments.length?(l.duration=t,this):l.duration},s.delay=function(t){return arguments.length?(l.delay=t,this):l.delay},s.d=function(t){return arguments.length?(l.d=t,this):l.d},s.duration1=function(t){return arguments.length?(l.duration1=t,this):l.duration1},s.delay1=function(t){return arguments.length?(l.delay1=t,this):l.delay1},s.d1=function(t){return arguments.length?(l.d1=t,this):l.d1},s.duration2=function(t){return arguments.length?(l.duration2=t,this):l.duration2},s.delay2=function(t){return arguments.length?(l.delay2=t,this):l.delay2},s.d2=function(t){return arguments.length?(l.d1=t,this):l.d1},s.arrowStyles=function(t){return arguments.length?(l.arrowStyles=t,this):l.arrowStyles},s.text=function(t){return arguments.length?(l.text=t,this):l.text},s.textReverseDirection=function(t){return arguments.length?(l.textReverseDirection=t,this):l.textReverseDirection},s.textStartOffset=function(t){return arguments.length?(l.textStartOffset=t,this):l.textStartOffset},s.textDx=function(t){return arguments.length?(l.textDx=t,this):l.textDx},s.textDy=function(t){return arguments.length?(l.textDy=t,this):l.textDy},s.textStyles=function(t){return arguments.length?(l.textStyles=t,this):l.textStyles},s.margin=function(t){return arguments.length?(l.margin=Object.assign({},l.margin,t),this):l.margin},s};t.Yarrow=r});