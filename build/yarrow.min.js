!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection")):"function"==typeof define&&define.amd?define(["exports","d3-selection"],e):e(t.yarrow=t.yarrow||{},t.d3_selection)}(this,function(t,e){"use strict";var n=function(){var t={},e=[];return t.arrow=function(t,n){n=n||document.body;var o=new r(this,t,n);return e.push(o),o},t.arrows=function(t,n){return arguments.length?(n=n||document.body,t.forEach(function(t){e.push(new r(this,t,n))}),this):e},t.remove=function(t){for(var n=-1,r=e.length;n++<r;)if(e[n].id===t)return e.splice(n,1)},t},r=function(t,n,r){var a,s={},i=new o,d="id"+Math.random().toString(36).substr(2,10),f=e.select(r),u=n.duration||300,l=n.delay||0,p=n.d||function(t,e){return e.m(t.dx>0?0:Math.abs(t.dx),t.dy>0?0:Math.abs(t.dy))+e.l(t.dx>0?t.dx:0,t.dy>0?t.dy:0)},c=n.duration1||200,y=n.delay1||u+l,h=n.d1||function(t,e){return e.m(0,0)+e.l(-20,-10)},x=n.duration2||c,m=n.delay||u+l,g=n.d2||function(t,e){return e.m(0,0)+e.l(-20,10)},v=n.text,w=("function"==typeof n.textReverseDirection?n.textReverseDirection(n,i):n.textReverseDirection)||!1,k=("function"==typeof n.textStartOffset?n.textStartOffset(n,i,w):n.textStartOffset)||0,b=n.textDx||0,M=n.textDy||-5,L={top:20,right:20,bottom:20,left:20},T=Math.abs(n.dx),_=Math.abs(n.dy),D=Math.min(n.y,n.y+n.dy)-L.top,j=Math.min(n.x,n.x+n.dx)-L.left,O=T+L.left+L.right,P=_+L.top+L.bottom;return s.id=d,s.render=function(){a=f.append("svg").attrs({id:d,"xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve","class":"yarrow",viewBox:"0 0 "+O+" "+P+" ",width:O+"px",height:P+"px"}).styles({top:D+"px",left:j+"px"});var t,e,r,o,s=a.append("g").attrs({transform:"translate("+L.left+","+L.top+")"}),T=s.append("path").attrs({id:"path_"+d,"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow",d:"function"==typeof p?p(n,i):p}),_=T.node(),S="function"==typeof _.getTotalLength;S?(t=_.getTotalLength(),e=_.getPointAtLength(t-1),r=_.getPointAtLength(t)):(t=0,e={x:0,y:0},r={x:0,y:0}),o=i.angle(e,r),T.styles({"animation-duration":u/1e3+"s","animation-delay":l/1e3+"s","stroke-dasharray":t+" "+t,"stroke-dashoffset":t});var A=s.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-1",d:"function"==typeof h?h(n,i):h,transform:"translate("+r.x+","+r.y+")rotate("+o+")"}),R=S?A.node().getTotalLength():0;A.styles({"animation-duration":c/1e3+"s","animation-delay":y/1e3+"s","stroke-dasharray":R+" "+R,"stroke-dashoffset":R});var q=s.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round","class":"arrow tip-2",d:"function"==typeof g?g(n,i):g,transform:"translate("+r.x+","+r.y+")rotate("+o+")"}),z=S?q.node().getTotalLength():0;q.styles({"animation-duration":x/1e3+"s","animation-delay":m/1e3+"s","stroke-dasharray":z+" "+z,"stroke-dashoffset":z});var B=(s.append("path").attrs({id:"path_reverse_"+d,d:("function"==typeof p?p(n,i):p)+" z"}),s.append("text").attrs({"class":"arrow text",dx:b,dy:M})),E=B.append("textPath").attrs({"xlink:href":w?"#path_reverse_"+d:"#path_"+d,startOffset:w?2*t-k:k}).styles({opacity:0}).text(v);return setTimeout(function(){E.styles({transition:"all "+u/1e3+"s linear",opacity:1})},10),this},s.dispose=function(e,n){function r(t,e){return e?(t.selectAll(".arrow").styles({transition:"all "+e/1e3+"s linear",opacity:0}),void setTimeout(function(){return t.remove()},e)):t.remove()}var o=f.select("#"+d);t.remove(d),n?setTimeout(function(){r(o,e)},n):r(o,e)},s},o=function(){var t={};return t.m=function(t,e){return"M"+t+","+e+" "},t.l=function(t,e){return"L"+t+","+e+" "},t.angle=function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},t};t.Yarrow=n});